#---------------------------------#
#      general configuration      #
#---------------------------------#

# version format
version: '{build}'

# Do not increment build number for pull requests (GitHub only)
pull_requests:
  do_not_increment_build_number: true

branches:
  only:
  - dev
  - master

# Do not build on tags (GitHub only)
skip_tags: true

#---------------------------------#
#    environment configuration    #
#---------------------------------#
cache:
  - packages

#---------------------------------#
#       build configuration       #
#---------------------------------#

# build platform, i.e. x86, x64, Any CPU. This setting is optional.
platform: Any CPU

# build Configuration, i.e. Debug, Release, etc.
configuration: Release

os: Visual Studio 2017

before_build:
  - dotnet --info
  - dotnet restore

build:
  parallel: true                                    # enable MSBuild parallel builds
  project: DotNetToolkit.Repository.sln             # path to Visual Studio solution or project

after_build:
  - dotnet pack .\src\DotNetToolkit.Repository\DotNetToolkit.Repository.csproj --configuration Release
  - dotnet pack .\src\DotNetToolkit.Repository.InMemory\DotNetToolkit.Repository.InMemory.csproj --configuration Release
  - dotnet pack .\src\DotNetToolkit.Repository.EntityFramework\DotNetToolkit.Repository.EntityFramework.csproj --configuration Release
  - dotnet pack .\src\DotNetToolkit.Repository.EntityFrameworkCore\DotNetToolkit.Repository.EntityFrameworkCore.csproj --configuration Release
  - dotnet pack .\src\DotNetToolkit.Repository.AdoNet\DotNetToolkit.Repository.AdoNet.csproj --configuration Release
  - dotnet pack .\src\DotNetToolkit.Repository.Extensions.Microsoft.DependencyInjection\DotNetToolkit.Repository.Extensions.Microsoft.DependencyInjection.csproj --configuration Release

# deployment builds
deploy:
- provider: NuGet
  server: https://www.myget.org/F/dotnettoolkitrepositorydev/api/v2/package
  api_key:
    secure: cFsMUNC2a8k548E/iKlw/zglFoowEyPd2uPtCoY8pCc9mW2Hh8drjw6raWNDl/JX
  skip_symbols: true
  on:
    branch: dev
- provider: NuGet
  server: https://www.myget.org/F/dotnettoolkitrepositorydev/api/v2/package
  api_key:
    secure: cFsMUNC2a8k548E/iKlw/zglFoowEyPd2uPtCoY8pCc9mW2Hh8drjw6raWNDl/JX
  skip_symbols: true
  on:
    branch: master
- provider: NuGet
  name: production
  api_key:
    secure: uSU6YGrWfh7Ruar11vqDFOtauPZXzKYFHUp8WoK86wDjT5ahRJXpLqPfusF+oKFd
  on:
    appveyor_repo_tag: true
    
#---------------------------------#
#       tests configuration       #
#---------------------------------#
test_script:
  - dotnet test .\test\DotNetToolkit.Repository.Test\DotNetToolkit.Repository.Test.csproj --configuration Release
  - dotnet test .\test\DotNetToolkit.Repository.Integration.Test\DotNetToolkit.Repository.Integration.Test.csproj --configuration Release
  
artifacts:
  - path: '**\DotNetToolkit.Repository.*.nupkg'     # find all NuGet packages recursively
